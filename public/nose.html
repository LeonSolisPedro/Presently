<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fabric.js JSON Example</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>
  <style>
    canvas {
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>
  <canvas id="canvas" width="600" height="400"></canvas>
  <button onclick="emulateOnline()">Emulate online behaviour</button>
  <script>
    // Initialize Fabric.js canvas
    const canvas = new fabric.Canvas('canvas');

    // Example JSON string representing Fabric.js objects
    const jsonString = `{
            "objects": [
                {
                    "type": "rect",
                    "left": 100,
                    "top": 100,
                    "width": 100,
                    "height": 100,
                    "fill": "red"
                },
                {
                    "type": "circle",
                    "left": 250,
                    "top": 100,
                    "radius": 50,
                    "fill": "blue"
                }
            ],
            "background": "white"
        }`;

    // Load objects from JSON
    canvas.loadFromJSON(jsonString, canvas.renderAll.bind(canvas), (o, object) => {
      console.log('Object loaded:', object);
    });


    function emulateOnline() {
      const circle = new fabric.Circle({
        id: 10000,
        left: 200,
        top: 100,
        fill: 'blue',
        radius: 30
      });

      // Add the circle to the canvas
      canvas.add(circle);

      setInterval(() => {
        moveCircle(circle);
    }, 1000); // Change position every 1000 milliseconds (1 second)
    }

    function moveCircle(circle) {
    // Update the circle's coordinates
    circle.left += 10; // Move right by 10 pixels
    circle.top += 5;   // Move down by 5 pixels
    
    // Update the circle's coordinates in the canvas
    circle.setCoords();
    canvas.renderAll(); // Render the updated canvas
}
  </script>
</body>

</html>